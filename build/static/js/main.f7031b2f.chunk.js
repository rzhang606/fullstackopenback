(this.webpackJsonpphonebook=this.webpackJsonpphonebook||[]).push([[0],{23:function(e,t,n){e.exports=n(53)},48:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(7),o=n.n(c),u=n(1),i=n.n(u),l=n(4),s=n(3),p=function(e){var t=e.input,n=e.inputHandler;return r.a.createElement("form",null,r.a.createElement("div",null,"Filter by name: ",r.a.createElement("input",{value:t,onChange:n})))},d=n(5),f=n.n(d),m="/api/persons",b=null,v={getAll:function(){return console.log("Getting all from server ... "),f.a.get(m).then((function(e){return e.data}))},create:function(){var e=Object(l.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:b}},e.next=3,f.a.post(m,t,n);case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(e){return f.a.delete("".concat(m,"/").concat(e))},update:function(e,t){return f.a.put("".concat(m,"/").concat(e),t).then((function(e){return e.data}))},setToken:function(e){b="bearer ".concat(e)}},g=n(6),h=n(20),E=function(e){return function(t){t(w(e)),setTimeout((function(){return t(w(""))}),5e3)}},w=function(e){return{type:"E_SET",data:e}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"E_SET":return t.data;default:return e}},O=function(){return function(e){v.getAll().then((function(t){return e({type:"P_SET",data:t})})).catch((function(t){return e(function(e){return function(t){t(w(e.message)),setTimeout((function(){return t(w(""))}),5e3)}}(t))}))}},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(console.log("Action:",t),t.type){case"P_SET":return t.data;default:return e}},j=function(e){return function(t){t(x(e)),setTimeout((function(){return t(x(""))}),5e3)}},x=function(e){return{type:"N_SET",data:e}},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"N_SET":return t.data;default:return e}},T=Object(g.c)({people:S,error:k,notification:y}),L=Object(g.d)(T,Object(g.a)(h.a));console.log("State:",L.getState());var N=L,C=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=N.getState().people,0===(a=n.filter((function(e){return e.name===t.name}))).length){e.next=24;break}if(a[0].number!==t.number){e.next=7;break}N.dispatch(E("".concat(t.name," is already added to phonebook."))),e.next=22;break;case 7:if(!window.confirm("Update ".concat(t.name,"'s number with ").concat(t.number,"?"))){e.next=22;break}return console.log("Updating new number"),e.prev=10,e.next=13,v.update(a[0].id,t);case 13:r=e.sent,N.dispatch(O()),N.dispatch(j("".concat(r.name,"'s number has been updated"))),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(10),console.log(e.t0),N.dispatch(E("Update unsuccessful: ".concat(e.t0)));case 22:e.next=36;break;case 24:return e.prev=24,e.next=27,v.create(t);case 27:c=e.sent,N.dispatch(O()),N.dispatch(j("".concat(c.name," has been added"))),e.next=36;break;case 32:e.prev=32,e.t1=e.catch(24),console.log(e.t1),N.dispatch(E("".concat(t.name," could not be added: ").concat(e.t1)));case 36:case"end":return e.stop()}}),e,null,[[10,18],[24,32]])})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=N.getState().people,(a=n.find((function(e){return e.id===t})))||N.dispatch(E("Does not exist")),!window.confirm("Delete ".concat(a.name,"'s record?"))){e.next=16;break}return console.log("Deleting: ",t,a.name),e.prev=6,e.next=9,v.remove(t);case 9:N.dispatch(O()),N.dispatch(j("Successfully Deleted")),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),N.dispatch(E("".concat(e.t0)));case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),H=function(e){var t=e.persons,n=void 0===t?[]:t,c=Object(a.useState)(""),o=Object(s.a)(c,2),u=o[0],i=o[1],l=n;return""!==u&&(l=n.filter((function(e){return e.name.toLowerCase().includes(u.toLowerCase())}))),r.a.createElement("div",null,l.map((function(e){return r.a.createElement("p",{key:e.name},e.name," ",e.number,r.a.createElement("button",{onClick:function(){return P(e.id)}},"delete"))})),r.a.createElement(p,{input:u,inputHandler:function(e){i(e.target.value)}}))},U=function(){var e=N.getState().notification;return""===e?null:r.a.createElement("div",{className:"notification"},e)},D=function(e){e.message;var t=N.getState().error;return""===t?null:r.a.createElement("div",{className:"error"},t)},_=function(e){var t=e.title,n=e.input,a=e.inputHandler;return r.a.createElement("div",null,r.a.createElement("p",null,t,":",r.a.createElement("input",{value:n,onChange:a})))},A=function(e){var t=Object(a.useState)(!1),n=Object(s.a)(t,2),c=n[0],o=n[1],u={display:c?"none":""},i={display:c?"":"none"},l=function(){o(!c)};return r.a.createElement("div",null,r.a.createElement("div",{style:u},r.a.createElement("button",{onClick:l},e.buttonLabel)),r.a.createElement("div",{style:i},e.children,r.a.createElement("button",{onClick:l},"Cancel")))},I=function(e){var t=e.login,n=Object(a.useState)(""),c=Object(s.a)(n,2),o=c[0],u=c[1],i=Object(a.useState)(""),l=Object(s.a)(i,2),p=l[0],d=l[1];return r.a.createElement(A,{buttonLabel:"Login here"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),console.log("Logging in for",o),t({username:o,password:p}),u(""),d("")}},r.a.createElement(_,{title:"Username",input:o,inputHandler:function(e){u(e.target.value)}}),r.a.createElement(_,{title:"Password",input:p,inputHandler:function(e){d(e.target.value)}}),r.a.createElement("button",{type:"submit"},"Login")))},J=function(e){var t=e.user,n=Object(a.useState)(""),c=Object(s.a)(n,2),o=c[0],u=c[1],i=Object(a.useState)(""),l=Object(s.a)(i,2),p=l[0],d=l[1];return r.a.createElement(A,{buttonLabel:"Create New Note"},r.a.createElement("h2",null,"Add New as ",t.name,":"),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),C({name:o,number:p}),u(""),d("")}},r.a.createElement(_,{title:"Name",input:o,inputHandler:function(e){u(e.target.value)}}),r.a.createElement(_,{title:"Number",input:p,inputHandler:function(e){d(e.target.value)}}),r.a.createElement("div",null,r.a.createElement("button",{type:"submit"},"add"))))},F={login:function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},z=function(){var e=Object(a.useState)(null),t=Object(s.a)(e,2),n=t[0],c=t[1],o=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.login(t);case 3:n=e.sent,window.localStorage.setItem("loggedPersonUser",JSON.stringify(n)),v.setToken(n.token),c(n),N.dispatch(j("Logged in as ".concat(n.name))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),N.dispatch(E("Wrong Credentials"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){console.log("Fetching data ... "),N.dispatch(O())}),[]),Object(a.useEffect)((function(){var e=window.localStorage.getItem("loggedPersonUser");if(e){var t=JSON.parse(e);c(t),N.dispatch(j("Logged in as ".concat(t.name))),v.setToken(t.token)}}),[]),r.a.createElement("div",null,r.a.createElement("h2",null,"Phonebook"),r.a.createElement(U,null),r.a.createElement(D,null),null===n?r.a.createElement("div",null,r.a.createElement(I,{login:o}),r.a.createElement("h2",null,"Please log in to view numbers")):r.a.createElement("div",null,r.a.createElement(J,{user:n}),r.a.createElement("button",{onClick:function(){window.localStorage.removeItem("loggedPersonUser"),v.setToken(null),c(null),N.dispatch(j("Logged Out"))}},"Log Out"),r.a.createElement("h2",null,"Numbers"),r.a.createElement(H,{persons:N.getState().people})))},B=(n(48),n(22)),G=function(){o.a.render(r.a.createElement(B.a,{store:N},r.a.createElement(z,null)),document.getElementById("root"))};G(),N.subscribe(G)}},[[23,1,2]]]);
//# sourceMappingURL=main.f7031b2f.chunk.js.map